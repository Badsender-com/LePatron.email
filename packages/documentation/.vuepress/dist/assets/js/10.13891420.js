(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{367:function(e,t,o){"use strict";o.r(t);var s=o(42),i=Object(s.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"mosaico-editor"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#mosaico-editor"}},[e._v("#")]),e._v(" Mosaico Editor")]),e._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/voidlabs/mosaico",target:"_blank",rel:"noopener noreferrer"}},[e._v("original repository"),o("OutboundLink")],1)]),e._v(" "),o("p",[e._v("Mosaico's Editor is based on "),o("a",{attrs:{href:"https://knockoutjs.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Knockout"),o("OutboundLink")],1),o("br"),e._v("\nIt's served as a standalone front application.")]),e._v(" "),o("h2",{attrs:{id:"serving-the-editor"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#serving-the-editor"}},[e._v("#")]),e._v(" Serving the Editor")]),e._v(" "),o("p",[e._v("The editor is rendered by a specific express controller:"),o("br"),e._v(" "),o("code",[e._v("packages/server/controllers/mailings/mosaico-editor.js")])]),e._v(" "),o("p",[e._v("You'll find the base HTML file at:"),o("br"),e._v(" "),o("code",[e._v("packages/server/html-templates/mosaico-editor.pug")])]),e._v(" "),o("p",[e._v("It's here that we pass any endpoints URL & data to Mosaico")]),e._v(" "),o("h2",{attrs:{id:"build-extensions"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#build-extensions"}},[e._v("#")]),e._v(" Build & extensions")]),e._v(" "),o("p",[e._v("Mosaico's editor has been enhanced during Badsender's development."),o("br"),e._v("\nThis was done by:")]),e._v(" "),o("ul",[o("li",[e._v("tweaking the "),o("a",{attrs:{href:"http://browserify.org/demos.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Browserify's build"),o("OutboundLink")],1),e._v(" in the gulpfile.")]),e._v(" "),o("li",[e._v("writing some extensions.")])]),e._v(" "),o("p",[e._v("Mosaico's Editor is extendable by design (see "),o("code",[e._v("src/js/ext/badsender-extensions.js")]),e._v(")"),o("br"),e._v("\nAll Badsender's extensions are prefixed by "),o("code",[e._v("badsender-")]),e._v("."),o("br"),e._v("\nAny Badsender's code will also be transformed by "),o("a",{attrs:{href:"https://babeljs.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("BabelJS"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("We rely on 2 environments variables to clean up the bundle:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("process.env.MOSAICO")]),e._v(": this will be removed from the bundle")]),e._v(" "),o("li",[o("code",[e._v("process.env.BADSENDER")]),e._v(": this will be kept")])]),e._v(" "),o("p",[e._v("This allow us to keep the diff from the original code as low as possible")]),e._v(" "),o("h2",{attrs:{id:"templates-and-models"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#templates-and-models"}},[e._v("#")]),e._v(" Templates and models")]),e._v(" "),o("p",[e._v("Mosaico's template define the blocks & the data model:")]),e._v(" "),o("ul",[o("li",[e._v("It will parse any "),o("code",[e._v("@supports -ko-blockdefs {}")]),e._v(" CSS rules to deduce which kind of widgets & data representation the template supports.")]),e._v(" "),o("li",[e._v("Then in the HTML any "),o("code",[e._v('data-ko-block="blockName"')]),e._v(" will be transformed to a block on the left side.")]),e._v(" "),o("li",[e._v("Any binding inside those blocks will use "),o("code",[e._v("-ko-blockdefs")]),e._v(" widgets to define the data representation inside that block."),o("br"),e._v(" "),o("strong",[e._v("this is what will be persisted in the DB under the "),o("em",[e._v("data")]),e._v(" key in the collection")])])]),e._v(" "),o("h2",{attrs:{id:"download-preview"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#download-preview"}},[e._v("#")]),e._v(" Download & preview")]),e._v(" "),o("p",[e._v("Since only the JSON data are saved in DB, in order to get the HTML, you'll need to:")]),e._v(" "),o("ul",[o("li",[e._v("load the editor")]),e._v(" "),o("li",[e._v("use the "),o("code",[e._v("viewModel.exportHTML")]),e._v(":\nthis will render in the browser the mailing according to its data & the template\n(look at "),o("code",[e._v("src/js/viewmodel.js")]),e._v(")")]),e._v(" "),o("li",[e._v("call a Backend route with HTML content")]),e._v(" "),o("li",[e._v("then the HTML will be processed again in the "),o("code",[e._v("packages/server/controllers/mailings/download-zip.js")]),e._v(" controller")])]),e._v(" "),o("h2",{attrs:{id:"basic-front-initialisation-flow"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#basic-front-initialisation-flow"}},[e._v("#")]),e._v(" Basic front initialisation flow")]),e._v(" "),o("p",[e._v("The entry point is "),o("code",[e._v("src/js/app.js")])]),e._v(" "),o("ul",[o("li",[e._v("init")]),e._v(" "),o("li",[e._v("start")])]),e._v(" "),o("p",[e._v("in "),o("code",[e._v("src/js/template-loader.js")])]),e._v(" "),o("ul",[o("li",[e._v("templateLoader: Ajax datas")]),e._v(" "),o("li",[e._v("templateCompiler:\n"),o("ul",[o("li",[e._v("Initialize viewmodel (./viewmodel.js)")]),e._v(" "),o("li",[e._v("Add server datas")]),e._v(" "),o("li",[e._v("apply plugins (server-storage, setEditorIcon + mosaico defined)")])])])])])}),[],!1,null,null,null);t.default=i.exports}}]);