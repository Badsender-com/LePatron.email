<div id="tooltabs" class="tabs_horizontal button_color" data-bind="tabs: { active: $root.selectedTool }">
  <!-- VueJs for the esp component-->
  <div id="espModal">
    <esp-plugin />
  </div>
  <div id="customizedBlockModal">
    <customized-block-plugin />
  </div>
  <div class="tooltabs__top-bar">
    <a class="tooltabs__top-logo" href="/" data-bind="attr: { href: $root.logoUrl }">
      <img data-bind="attr: { src: $root.logoPath, alt: $root.logoAlt }" alt="mosaico" />
    </a>
    <ul class="tooltabs__list">
      <li class="tooltabs__item" data-bind="tooltips: {}"><a title="Blocks ready to be added to the template"
          data-local="true" href="#toolblocks"
          data-bind="attr: { title: $root.t('Blocks ready to be added to the template') }"><i
            class="fa fa-fw fa-cubes"></i> <span data-bind="html: $root.t('Blocks')">Blocks</span></a></li>
      <li class="tooltabs__item" data-bind="tooltips: {}"><a title="Edit content options" href="#toolcontents"
          data-local="true" data-bind="attr: { title: $root.t('Edit content options') }"><i
            class="fa fa-fw fa-pencil"></i> <span data-bind="html: $root.t('Content')">Content</span></a></li>
      <li class="tooltabs__item" data-bind="tooltips: {}"><a title="Edit style options" href="#toolstyles"
          data-local="true" data-bind="attr: { title: $root.t('Edit style options') }"><i
            class="fa fa-fw fa-paint-brush"></i> <span data-bind="html: $root.t('Style')">Style</span></a></li>
    </ul>
  </div>

  <div id="toolblocks" data-bind="scrollable: true">
    <div id="blockTabs" class="blocks-tabs-horizontal button_color blocks-tabs"
      data-bind="tabs: { active: $root.blocksActiveTab() }">
      <div class="blocks-tab-item"
        data-bind="click: function() { $root.blocksActiveTab('TEMPLATE_BLOCKS'); }, css: { 'blocks-tab-active': $root.blocksActiveTab() === 'TEMPLATE_BLOCKS' }">
        <i class="fa fa-fw fa-cubes"></i> <span data-bind="html: $root.t('Template Blocks')">Template Blocks</span>
      </div>
      <div class="blocks-tab-item"
        data-bind="click: function() { $root.blocksActiveTab('CUSTOM_BLOCKS'); }, css: { 'blocks-tab-active': $root.blocksActiveTab() === 'CUSTOM_BLOCKS' }">
        <i class="fa fa-fw fa-user"></i> <span data-bind="html: $root.t('Custom Blocks')">Custom Blocks</span>
      </div>
    </div>

    <div data-bind="visible: $root.blocksActiveTab() === 'TEMPLATE_BLOCKS'">
      <div class="block-list" data-bind="foreach: blockDefs" style="text-align: center">
        <div class="draggable-item" data-bind="withProperties: { templateMode: 'show' }">
          <div class="block"
            data-bind="extdraggable: { connectClass: 'sortable-blocks-edit', data: $data, dropContainer: '#main-wysiwyg-area', dragging: $root.dragging, 'options': { handle: '.handle', distance: 10, 'appendTo': '#page' } }, click: $root.addBlock"
            style="position: relative;">
            <div title="Click or drag to add this block to the template" class="handle"
              data-bind="attr: { title: $root.t('Click or drag to add this block to the template') }, tooltips: {}">
            </div>
            <img
              data-bind="attr: { alt: $root.t('__name__', { name: ko.utils.unwrapObservable(type) }), src: $root.templatePath('edres/'+ko.utils.unwrapObservable(type)+'.png') }"
              alt="__name__" />
            <span class="block-name"
              data-bind="html: $root.t('__name__', { name: ko.utils.unwrapObservable(type) })">__name__</span>
          </div>
          <a href="javascript:void(0)" class="addblockbutton"
            data-bind="click: $root.addBlock, button: { label: $root.t('Add') }">Add</a>
        </div>

      </div>
    </div>
    <div class="block-list" data-bind="visible: $root.blocksActiveTab() === 'CUSTOM_BLOCKS'">
      <!-- Add the Vue.js component here -->
      <div id="personalizedBlocksPlugin">
        <personalized-blocks-plugin />
      </div>
      <div data-bind="visible: personalizedBlocks().length > 0, foreach: personalizedBlocks()">
        <div class="draggable-item" data-bind="withProperties: { templateMode: 'show' }">
          <div class="block block-custom"
            data-bind="extdraggable: { connectClass: 'sortable-blocks-edit', data: $data, dropContainer: '#main-wysiwyg-area', dragging: $root.dragging, 'options': { handle: '.handle', distance: 10, 'appendTo': '#page' } }, click: $root.addBlock">
            <div title="Click or drag to add this block to the template" class="handle"
              data-bind="attr: { title: $root.t('Click or drag to add this block to the template') }, tooltips: {}">
            </div>
            <span class="block-name"
              data-bind="html: $root.t('__name__', { name: ko.utils.unwrapObservable(blockInformation.name) })">__name__</span>
            <div class="block-content-custom">
              <span class="block-content-custom-text"
                data-bind="html: $root.t('__name__', { name: ko.utils.unwrapObservable(blockInformation.category) })">__name__</span>
            </div>
            <div class="block-content-custom">
              <span class="block-content-custom-text"
                data-bind="html: $root.t('__name__', { name: ko.utils.unwrapObservable(blockInformation.userDetails.name) })">__name__</span>
            </div>
          </div>
          <div class="addblockbutton custom">
            <div class="buttons-container">
              <div data-bind="if: $root.currentUser()?.isAdminOfCurrentGroup">
                <a href="javascript:void(0)" class="ui-button" data-bind="click: $root.deleteBlock">
                  <i class="fa fa-trash"></i> <!-- Delete Icon -->
                </a>
              </div>
              <div data-bind="if: $root.currentUser()?.isAdminOfCurrentGroup">
                <a href="javascript:void(0)" class="ui-button" data-bind="click: $root.editBlock">
                  <i class="fa fa-pencil"></i> <!-- Edit Icon -->
                </a>
              </div>
              <a href="javascript:void(0)" data-bind="click: $root.addBlock, button: { label: $root.t('Add') }">Add</a>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div id="toolcontents" data-bind="scrollable: true">
    <!-- ko if: $root.selectedBlock() !== null -->
    <div data-bind="block: $root.selectedBlock"></div>
    <!-- /ko -->
    <!-- ko if: $root.selectedBlock() == null -->
    <div class="noSelectedBlock"
      data-bind="text: $root.t('By clicking on message parts you will select a block and content options, if any, will show here')">
      By clicking on message parts you will select a block and content options, if any, will show here</div>
    <!-- /ko -->
    <!-- ko block: content -->content<!-- /ko -->
    <div id="tracking-params">
      <tracking-params-plugin />
    </div>
  </div>

  <div id="toolstyles" data-bind="scrollable: true, withProperties: { templateMode: 'styler' }">
    <!-- ko if: typeof $root.content().theme === 'undefined' || typeof $root.content().theme().scheme === 'undefined' || $root.content().theme().scheme() === 'custom' -->
    <!-- ko if: $root.selectedBlock() !== null -->
    <div
      data-bind="block: $root.selectedBlock, css: { workLocal: $root.selectedBlock().customStyle, workGlobal: typeof $root.selectedBlock().customStyle === 'undefined' || !$root.selectedBlock().customStyle() }">
    </div>
    <!-- /ko -->
    <!-- ko if: $root.selectedBlock() == null -->
    <div class="noSelectedBlock"
      data-bind="text: $root.t('By clicking on message parts you will select a block and style options, if available, will show here')">
      By clicking on message parts you will select a block and style options, if available, will show here</div>
    <!-- /ko -->
    <div class="workGlobalContent">
      <!-- ko block: content --><!-- /ko -->
    </div>
    <!-- /ko -->
  </div>
</div>

<div id="toolimages" class="slidebar" data-bind="scrollable: true, css: { hidden: $root.showGallery() === false }">
  <div class="close" data-bind="click: $root.showGallery.bind($element, false);">X</div>
  <span class="pane-title" data-bind="text: $root.t('gallery-title')">Galleries:</span>

  <!-- ko if: $root.showGallery() -->
  <div id="toolimagestab" class="tabs_horizontal" data-bind="tabs: { active: $root.selectedImageTab }">
    <ul>
      <li data-bind="tooltips: {}"><a title="gallery-mailing" data-local="true" href="#toolimagesgallery"
          data-bind="attr: { title: $root.t('gallery-mailing') }, text: $root.t('gallery-mailing')">gallery-mailing</a>
      </li>
      <li data-bind="tooltips: {}"><a title="gallery-template" data-local="true" href="#toolimagesgallerytemplate"
          data-bind="attr: { title: $root.t('gallery-template') }, text: $root.t('gallery-template')">gallery-template</a>
      </li>
    </ul>

    <div id="toolimagesgallery" class="gallery-panel">
      <!-- ko template: {name: 'gallery-upload', data: { type: 'mailing' } } --># mailing gallery fileupload
      #<!-- /ko -->
      <!-- ko if: $root.mailingGalleryStatus() === false --><a class="loadbutton" title="Show images from the gallery"
        href="javascript:void(0)"
        data-bind="attr: { title: $root.t('Show images from the gallery') }, click: $root.loadMailingGallery, button: { disabled: $root.mailingGalleryStatus, icons: { primary: 'fa fa-fw fa-picture-o' }, label: $root.mailingGalleryStatus() == 'loading' ? $root.t('Loading...') : $root.t('Load gallery'), text: true }">#
        load gallery #</a><!-- /ko -->


      <!-- ko if: $root.mailingGalleryStatus() === 'loading' -->
      <div class="galleryEmpty" data-bind="text: $root.t('gallery-mailing-loading')">Loading mailing gallery…</div>
      <!-- /ko -->
      <!-- ko if: $root.mailingGalleryStatus() === 0 -->
      <div class="galleryEmpty" data-bind="text: $root.t('gallery-mailing-empty')">The mailing gallery is empty</div>
      <!-- /ko -->
      <!-- ko template: {name: 'gallery-images', data: { items: mailingGallery, type: 'mailing' } } --># mailing gallery
      #<!-- /ko -->
    </div>

    <div id="toolimagesgallerytemplate" class="gallery-panel">
      <!-- ko template: {name: 'gallery-upload', data: { type: 'template' } } --># mailing template fileupload
      #<!-- /ko -->

      <!-- ko if: $root.templateGalleryStatus() === false --><a class="loadbutton" title="Show images from the gallery"
        href="javascript:void(0)"
        data-bind="attr: { title: $root.t('Show images from the gallery') }, click: $root.loadTemplateGallery, button: { disabled: $root.templateGalleryStatus, icons: { primary: 'fa fa-fw fa-picture-o' }, label: $root.templateGalleryStatus() == 'loading' ? $root.t('Loading...') : $root.t('Load gallery'), text: true }">#
        load gallery #</a><!-- /ko -->


      <!-- ko if: $root.templateGalleryStatus() === 'loading' -->
      <div class="galleryEmpty" data-bind="text: $root.t('gallery-mailing-loading')">Loading template gallery...</div>
      <!-- /ko -->
      <!-- ko if: $root.templateGalleryStatus() === 0 -->
      <div class="galleryEmpty" data-bind="text: $root.t('gallery-mailing-empty')">The template gallery is empty</div>
      <!-- /ko -->
      <!-- ko template: {name: 'gallery-images', data: { items: templateGallery, type: 'template' } } --># template
      gallery #<!-- /ko -->
    </div>
  </div>
  <!-- /ko -->

</div>

<div id="tooldebug" class="slidebar" data-bind="css: { hidden: $root.debug() === false }">
  <div class="close" data-bind="click: $root.debug.bind($element, false);">X</div>

  <!-- ko if: $root.debug -->
  Content:
  <pre data-bind='text: ko.toJSON(content, null, 2)' style="overflow: auto; height: 20%"></pre>
  BlockDefs:
  <pre data-bind='text: ko.toJSON(blockDefs, null, 2)' style="overflow: auto; height: 20%"></pre>
  <!-- /ko -->
  <a href="javascript:void(0)"
    data-bind="click: $root.exportHTMLtoTextarea.bind($element, '#outputhtml'); clickBubble: false, button: { text: true, label:'Generate' }">Output</a>
  <a href="javascript:void(0)"
    data-bind="click: $root.exportJSONtoTextarea.bind($element, '#outputhtml'); clickBubble: false, button: { text: true, label:'Export' }">Export</a>
  <a href="javascript:void(0)"
    data-bind="click: $root.importJSONfromTextarea.bind($element, '#outputhtml'); clickBubble: false, button: { text: true, label:'Import' }">Import</a>

  <textarea id="outputhtml" rows="10" style="width: 100%;"></textarea>
</div>

<div id="tooltheme" class="ui-widget slidebar" data-bind="css: { hidden: $root.showTheme() === false }">
  <div class="close" data-bind="click: $root.showTheme.bind($element, false);">X</div>

  <!-- ko withProperties: { templateMode: 'styler' } -->
  <!-- ko if: $root.showTheme -->
  <!-- ko block: $root.content().theme --><!-- /ko -->
  <!-- /ko -->
  <!-- /ko -->
</div>

<!-- Comments Panel -->
<div id="toolcomments" class="slidebar" data-bind="css: { hidden: $root.showComments() === false }">
  <div class="close" data-bind="click: $root.showComments.bind($element, false);">X</div>
  <span class="pane-title" data-bind="text: $root.t('comments-title')">Comments</span>

  <!-- ko if: $root.showComments() -->
  <div class="comments-content">
  <div class="comments-header">
    <!-- Filter info -->
    <!-- ko if: $root.selectedBlockForComments() -->
    <div class="comments-filter-info">
      <span><i class="fa fa-filter"></i> <span data-bind="text: $root.t('comments-filter-block')">Filtré par bloc</span></span>
      <button class="comments-btn comments-btn-small" data-bind="click: $root.showAllComments, text: $root.t('comments-show-all')">Tout voir</button>
    </div>
    <!-- /ko -->

    <!-- Stats -->
    <div class="comments-stats">
      <span class="stats-count" data-bind="text: $root.unresolvedCommentCount()">0</span> <span data-bind="text: $root.t('comments-count-label')">en attente</span>
    </div>
  </div>

  <!-- New comment form (only shown when NOT replying) -->
  <!-- ko ifnot: $root.replyingTo() -->
  <div class="comments-form">
    <div class="comments-textarea-wrapper">
      <textarea class="comments-textarea comment-textarea-main" rows="3"
        data-bind="value: $root.newCommentText, valueUpdate: 'afterkeydown', event: { input: $root.handleCommentInput, blur: function() { setTimeout($root.hideMentionSuggestions, 200); } }, attr: { placeholder: $root.t('comments-placeholder') }"></textarea>

      <!-- Mention suggestions dropdown -->
      <!-- ko if: $root.showMentionSuggestions() && $root.mentionSuggestions().length > 0 -->
      <div class="mention-suggestions">
        <!-- ko foreach: $root.mentionSuggestions() -->
        <div class="mention-suggestion" data-bind="click: function() { $root.insertMention($data); }">
          <span class="mention-name" data-bind="text: name"></span>
          <span class="mention-email" data-bind="text: email"></span>
        </div>
        <!-- /ko -->
      </div>
      <!-- /ko -->
    </div>

    <div class="comments-form-options">
      <!-- Category chips -->
      <div class="comments-chips-group">
        <span class="comment-chip" data-bind="click: function() { $root.newCommentCategory('general'); }, css: { selected: $root.newCommentCategory() === 'general' }">
          <i class="fa fa-comment-o"></i> <span data-bind="text: $root.t('comments-category-general')">Général</span>
        </span>
        <span class="comment-chip" data-bind="click: function() { $root.newCommentCategory('design'); }, css: { selected: $root.newCommentCategory() === 'design' }">
          <i class="fa fa-paint-brush"></i> <span data-bind="text: $root.t('comments-category-design')">Design</span>
        </span>
        <span class="comment-chip" data-bind="click: function() { $root.newCommentCategory('content'); }, css: { selected: $root.newCommentCategory() === 'content' }">
          <i class="fa fa-file-text-o"></i> <span data-bind="text: $root.t('comments-category-content')">Contenu</span>
        </span>
      </div>

      <!-- Severity chips -->
      <div class="comments-chips-group">
        <span class="comment-chip" data-bind="click: function() { $root.newCommentSeverity('info'); }, css: { selected: $root.newCommentSeverity() === 'info' }">
          <i class="fa fa-info-circle"></i> Info
        </span>
        <span class="comment-chip" data-bind="click: function() { $root.newCommentSeverity('important'); }, css: { selected: $root.newCommentSeverity() === 'important' }">
          <i class="fa fa-exclamation-triangle"></i> Important
        </span>
        <span class="comment-chip" data-bind="click: function() { $root.newCommentSeverity('blocking'); }, css: { selected: $root.newCommentSeverity() === 'blocking' }">
          <i class="fa fa-ban"></i> Bloquant
        </span>
      </div>

      <button class="comments-btn comments-btn-primary" data-bind="click: $root.createComment">
        <i class="fa fa-plus"></i> <span data-bind="text: $root.t('comments-add')">Ajouter</span>
      </button>
    </div>
  </div>
  <!-- /ko -->

  <!-- Loading state -->
  <!-- ko if: $root.commentsStatus() === 'loading' -->
  <div class="comments-loading">
    <i class="fa fa-spinner fa-spin"></i>
    <span data-bind="text: $root.t('comments-loading')">Chargement...</span>
  </div>
  <!-- /ko -->

  <!-- Empty state -->
  <!-- ko if: $root.commentsStatus() !== 'loading' && $root.filteredComments().length === 0 -->
  <div class="comments-empty">
    <i class="fa fa-comments-o"></i>
    <span data-bind="text: $root.t('comments-empty')">Aucun commentaire</span>
  </div>
  <!-- /ko -->

  <!-- Comments list -->
  <div class="comments-list" data-bind="foreach: $root.filteredComments()">
    <div class="comment-item" data-bind="css: { 'comment-resolved': resolved, 'comment-expanded': resolved && $root.isResolvedExpanded(_id), 'comment-editing': $root.editingComment() && $root.editingComment()._id === _id }, click: resolved ? function() { $root.toggleResolvedComment($data); } : function() {}, clickBubble: !resolved">
      <!-- Comment header -->
      <div class="comment-header">
        <span class="comment-author" data-bind="text: authorName || (_author && _author.name) || 'Anonyme'"></span>
        <span class="comment-date" data-bind="text: $root.formatCommentDate(createdAt)"></span>
        <!-- ko if: resolved -->
        <span class="comment-badge comment-badge-resolved"><i class="fa fa-check"></i> <span data-bind="text: $root.t('comments-resolved-badge')">Résolu</span></span>
        <!-- /ko -->
        <!-- ko if: !resolved && severity === 'important' -->
        <span class="comment-badge comment-badge-important"><i class="fa fa-exclamation-triangle"></i> Important</span>
        <!-- /ko -->
        <!-- ko if: !resolved && severity === 'blocking' -->
        <span class="comment-badge comment-badge-blocking"><i class="fa fa-ban"></i> Bloquant</span>
        <!-- /ko -->
        <!-- Category badge in header (always visible, even when collapsed) -->
        <!-- ko if: category === 'general' || !category -->
        <span class="comment-category"><i class="fa fa-comment-o"></i> <span data-bind="text: $root.t('comments-category-general')">Général</span></span>
        <!-- /ko -->
        <!-- ko if: category === 'design' -->
        <span class="comment-category"><i class="fa fa-paint-brush"></i> <span data-bind="text: $root.t('comments-category-design')">Design</span></span>
        <!-- /ko -->
        <!-- ko if: category === 'content' -->
        <span class="comment-category"><i class="fa fa-file-text-o"></i> <span data-bind="text: $root.t('comments-category-content')">Contenu</span></span>
        <!-- /ko -->
        <!-- Expand indicator for resolved -->
        <!-- ko if: resolved -->
        <i class="fa comment-expand-icon" data-bind="css: { 'fa-chevron-down': !$root.isResolvedExpanded(_id), 'fa-chevron-up': $root.isResolvedExpanded(_id) }"></i>
        <!-- /ko -->
      </div>

      <!-- Comment content (view mode) -->
      <!-- ko if: !$root.editingComment() || $root.editingComment()._id !== _id -->
      <div class="comment-text" data-bind="html: $root.formatCommentText(text)"></div>
      <!-- /ko -->

      <!-- Comment content (edit mode) -->
      <!-- ko if: $root.editingComment() && $root.editingComment()._id === _id -->
      <div class="comment-edit-form">
        <textarea class="comments-textarea" rows="3" data-bind="value: $root.editCommentText"></textarea>
        <div class="comment-edit-actions">
          <button class="comments-btn comments-btn-primary comments-btn-small" data-bind="click: $root.saveEditComment">
            <i class="fa fa-check"></i> <span data-bind="text: $root.t('comments-save')">Enregistrer</span>
          </button>
          <button class="comments-btn comments-btn-small" data-bind="click: $root.cancelEditComment, text: $root.t('comments-cancel')">Annuler</button>
        </div>
      </div>
      <!-- /ko -->

      <!-- Comment actions (icon buttons) -->
      <!-- ko if: !$root.editingComment() || $root.editingComment()._id !== _id -->
      <div class="comment-actions">
        <!-- ko if: !resolved -->
        <button class="comments-btn-icon" data-bind="click: function() { $root.startReply($data); }, clickBubble: false, attr: { title: $root.t('comments-reply') }">
          <i class="fa fa-reply"></i>
        </button>
        <button class="comments-btn-icon btn-icon-success" data-bind="click: function() { $root.resolveComment($data); }, clickBubble: false, attr: { title: $root.t('comments-resolve') }">
          <i class="fa fa-check"></i>
        </button>
        <!-- /ko -->
        <!-- ko if: $root.isCommentAuthor($data) -->
        <button class="comments-btn-icon" data-bind="click: function() { $root.startEditComment($data); }, clickBubble: false, attr: { title: $root.t('comments-edit') }">
          <i class="fa fa-pencil"></i>
        </button>
        <!-- /ko -->
        <!-- ko if: $root.canDeleteComment($data) -->
        <button class="comments-btn-icon btn-icon-danger" data-bind="click: function() { $root.deleteComment($data); }, clickBubble: false, attr: { title: $root.t('comments-delete') }">
          <i class="fa fa-trash-o"></i>
        </button>
        <!-- /ko -->
        <!-- Go to block link (in actions row) -->
        <!-- ko if: blockId && $root.blockExists(blockId) -->
        <span class="comment-go-to-block" data-bind="click: function() { $root.goToCommentBlock($data); }, clickBubble: false">
          <i class="fa fa-external-link"></i> <span data-bind="text: $root.t('comments-go-to-block')">Aller au bloc</span>
        </span>
        <!-- /ko -->
        <!-- ko if: blockId && !$root.blockExists(blockId) -->
        <span class="comment-go-to-block comment-block-deleted">
          <i class="fa fa-unlink"></i> <span data-bind="text: $root.t('comments-block-deleted')">Bloc supprimé</span>
        </span>
        <!-- /ko -->
      </div>
      <!-- /ko -->

      <!-- Replies -->
      <!-- ko if: $root.getReplies(_id).length > 0 -->
      <div class="comment-replies" data-bind="foreach: $root.getReplies(_id)">
        <div class="comment-reply" data-bind="css: { 'comment-resolved': resolved }">
          <div class="comment-header">
            <span class="comment-author" data-bind="text: authorName || (_author && _author.name) || 'Anonyme'"></span>
            <span class="comment-date" data-bind="text: $root.formatCommentDate(createdAt)"></span>
          </div>
          <div class="comment-text" data-bind="html: $root.formatCommentText(text)"></div>
          <div class="comment-actions">
            <!-- ko if: $root.canDeleteComment($data) -->
            <button class="comments-btn-icon btn-icon-danger" data-bind="click: function() { $root.deleteComment($data); }, attr: { title: $root.t('comments-delete') }">
              <i class="fa fa-trash-o"></i>
            </button>
            <!-- /ko -->
          </div>
        </div>
      </div>
      <!-- /ko -->

      <!-- Inline reply form (shown when replying to THIS comment) -->
      <!-- ko if: $root.replyingTo() && $root.replyingTo()._id === _id -->
      <div class="comment-reply-form">
        <div class="comments-replying-to">
          <span><i class="fa fa-reply"></i> <span data-bind="text: $root.t('comments-replying-to-prefix') + ' ' + $root.replyingTo().authorName">Réponse à...</span></span>
          <button class="comments-btn-cancel" data-bind="click: $root.cancelReply"><i class="fa fa-times"></i></button>
        </div>
        <div class="comments-textarea-wrapper">
          <textarea class="comments-textarea comment-textarea-reply" rows="2"
            data-bind="value: $root.newCommentText, valueUpdate: 'afterkeydown', event: { input: $root.handleCommentInput, blur: function() { setTimeout($root.hideMentionSuggestions, 200); } }, attr: { placeholder: $root.t('comments-placeholder') }"></textarea>

          <!-- Mention suggestions dropdown -->
          <!-- ko if: $root.showMentionSuggestions() && $root.mentionSuggestions().length > 0 -->
          <div class="mention-suggestions">
            <!-- ko foreach: $root.mentionSuggestions() -->
            <div class="mention-suggestion" data-bind="click: function() { $root.insertMention($data); }">
              <span class="mention-name" data-bind="text: name"></span>
              <span class="mention-email" data-bind="text: email"></span>
            </div>
            <!-- /ko -->
          </div>
          <!-- /ko -->
        </div>
        <div class="comment-reply-actions">
          <button class="comments-btn comments-btn-primary comments-btn-small" data-bind="click: $root.createComment">
            <i class="fa fa-paper-plane"></i> <span data-bind="text: $root.t('comments-add')">Envoyer</span>
          </button>
          <button class="comments-btn comments-btn-small" data-bind="click: $root.cancelReply, text: $root.t('comments-cancel')">Annuler</button>
        </div>
      </div>
      <!-- /ko -->
    </div>
  </div>
  </div><!-- .comments-content -->
  <!-- /ko -->
</div>
